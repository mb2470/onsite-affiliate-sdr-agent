graph TD
    %% LEAD SOURCES
    A[ğŸ“¥ CSV Upload] -->|Bulk import| B[leads table<br/>status: new]
    A2[â• Manual Add] -->|Single website| B
    A3[ğŸ” StoreLeads Discovery] -->|Top stores by category| B2[leads table<br/>status: enriched]

    %% ENRICHMENT
    B -->|Batch 50 domains| C{StoreLeads<br/>Bulk API}
    C -->|Found| D[Store Data<br/>products, sales, category<br/>country, platform, rank]
    C -->|Not Found| E[status: new<br/>~2,063 leads]
    
    D --> F{ICP Scoring<br/>3 Factors}
    
    %% SCORING
    F --> G1[âœ… Products â‰¥ 250]
    F --> G2[âœ… Sales â‰¥ $1M/mo]
    F --> G3[âœ… Target Category]
    
    G1 & G2 & G3 --> H{US/CA + 3/3?}
    H -->|Yes| I[ğŸŸ¢ HIGH<br/>~503 leads]
    H -->|US/CA + 2/3| J[ğŸŸ¡ MEDIUM<br/>~1,208 leads]
    H -->|Non-US/CA 2-3/3| J
    H -->|0-1/3| K[ğŸ”´ LOW<br/>~2,440 leads]

    %% CONTACT MATCHING
    I --> L{Contact Database<br/>509k contacts}
    J --> L
    L -->|Match on domain| M[has_contacts: true<br/>380 HIGH leads ready]
    L -->|No match| N[has_contacts: false<br/>123 HIGH leads need contacts]

    %% OUTREACH FLOW
    M --> O[ğŸ“‹ Step 1: Select Lead<br/>Filter: HIGH + Has Contacts]
    O --> P[âœ¨ Step 2: Generate Email<br/>Claude AI + lead context]
    P --> Q[ğŸ‘¥ Step 3: Find Contacts<br/>Scored by title relevance]
    
    Q --> R1[ğŸ”¥ Creator/Social â€” 95]
    Q --> R2[ğŸ¯ Marketing Leader â€” 100]
    Q --> R3[ğŸ¯ Digital/Ecommerce â€” 90]
    Q --> R4[ğŸŸ¢ Brand/Content â€” 70]
    Q --> R5[ğŸ‘” Executive â€” 60]
    
    R1 & R2 & R3 & R4 & R5 --> S{Send Method}
    
    S -->|Direct| T[ğŸ“§ Gmail API Send<br/>Instant, no tab switch]
    S -->|Fallback| U[ğŸ“§ Open in Gmail<br/>Compose window]
    
    T --> V[âœ… Lead: contacted<br/>outreach_log entry]
    U --> V

    %% BOUNCE HANDLING
    V --> W{Bounce Check<br/>Gmail API listener}
    W -->|Bounced| X[ğŸ—‘ï¸ Remove bad contact<br/>â†©ï¸ Reset lead to enriched]
    W -->|Delivered| Y[âœ… Awaiting Reply]

    %% STYLING
    style I fill:#166534,color:#fff
    style J fill:#854d0e,color:#fff
    style K fill:#991b1b,color:#fff
    style T fill:#6d28d9,color:#fff
    style V fill:#166534,color:#fff
    style X fill:#991b1b,color:#fff
    style Y fill:#166534,color:#fff
    style B fill:#1e293b,color:#fff
    style B2 fill:#1e293b,color:#fff
